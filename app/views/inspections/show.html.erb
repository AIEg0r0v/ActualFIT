<div id="openedInspection"class="row-fluid InspectionSelected">
    <div class="span12">
        <%= render partial: 'inspections/status', locals: {status: @inspection.status} %>
        <%= render partial: 'inspections/deadline', locals: {inspection: @inspection} %>
        <div class="row-fluid"  style="text-align: center;">

          <h3 style="margin: 0px;">
            <% if can? :edit, @inspection %>
                <%= link_to "Inspection #{@inspection.fullname }", edit_inspection_path(@inspection) %>
            <% else %>
                <%= "Inspection #{@inspection.fullname }" %>
            <% end %>
                      </h3>
          <% if can? :change_status, @inspection %>
              <% if ((current_user.has_role?(:admin, @inspection)) || (current_user.has_role?(:supervisor, @inspection)))%>
                  <% status_list = Inspection.admin_status_list %>
              <% else %>
                  <% status_list = Inspection.status_list  %>
              <% end %>
              <div class="dropdown">
                <!-- Link or button to toggle dropdown -->
                <a class="dropdown-toggle" data-toggle="dropdown" href="#menu1">
                  <%= content_tag :span, @inspection.status, id: "InspectionStatus" %>
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
                  <% status_list.each do |status| %>
                      <%= content_tag(:li, link_to(status, change_status_inspection_path(@inspection, status: status), confirm: "Change #{@inspection.name} status from #{@inspection.status} to #{status}?", method: :put, remote: true)) %>
                  <% end %>
                </ul>
              </div>
          <% else %>
              <%= @inspection.status %>
          <% end %>
        </div>
        <div class="row-fluid">
            <%= content_tag :div, id: "artifacts", class: "ArtifactsPanel span3 pull-left"  do -%>
              <div class="row-fluid Artifact-HeaderRow">
                <div class="span12 Artifacts">
                  <ul class="thumbnails">
                    <% if can? :create, Artifact, inspection_id: @inspection.id %>
                        <li>
                          <div class="thumbnail">
                            <%= content_tag :div, class: "well well-small Artifact" do -%>
                                <%= content_tag :div, class: "row-fluid ArtifactBody" do -%>
                                    <%= image_tag('icon_32/plus_32.png', alt:"add artifact") %>
                                    <%= link_to(content_tag(:strong, "add artifact", class:"ArtifactName"), new_inspection_artifact_path(@inspection.id), class: "ActionElement") %>
                                <% end -%>
                            <% end -%>
                          </div>
                        </li>
                    <% end %>
                    <% if can? :upload_remarks, @inspection %>
                        <li>
                          <div class="thumbnail">
                              <%= content_tag :div, class: "well well-small Artifact" do -%>
                                  <%= content_tag :div, class: "row-fluid ArtifactBody" do -%>
                                      <%= image_tag('icon_32/up_32.png', alt:"upload remark") %>
                                      <%= link_to(content_tag(:strong, "upload remarks", class:"ArtifactName"),upload_remarks_inspection_path(@inspection.id), class: "ActionElement") %>
                                  <% end -%>
                              <% end -%>
                          </div>
                        </li>
                    <% end %>
                    <% if can? :download_artifacts, @inspection %>
                        <li class="thumbnail">
                              <%= content_tag :div, class: "well well-small Artifact" do -%>
                                  <%= content_tag :div, class: "row-fluid ArtifactBody" do -%>
                                      <%= image_tag('icon_32/save_32.png', alt:"download artifacts") %>
                                      <%= link_to(content_tag(:strong, "download artifacts", class:"ArtifactName"), download_artifacts_inspection_path(@inspection.id), class: "ActionElement") %>
                                  <% end -%>
                              <% end -%>

                        </li>
                    <% end %>
                  </ul>
                </div>
              </div>
              <div class="row-fluid ArtifactsRowContainer">
                <div class="span12 Artifacts">
                  <%= content_tag :ul, class: "thumbnails", id: "ArtifactsList", data: { url: inspection_artifacts_url(@inspection)} do -%>
                    <% artifacts_html = render partial: 'artifacts/artifact', collection: @inspection.artifacts, as: :art, locals: {inspection: @inspection} %>
                    <%= artifacts_html || 'there is no artifacts'%>
                  <% end -%>
                </div> <!--span12-->
              </div>
            <% end -%>
            <%= content_tag :div, id: "remarks", class: "ArtifactComments span6 pull-left"  do -%>
              <div class="ArtifactCommentsInner">
                <%= content_tag :div, class: "row-fluid" do -%>
                  <table class="table table-striped table-hover">
                    <caption class="CommentsHeader">
                      <strong>Artifact Remark</strong>
                      <div class="CommentsClose"><strong>hide</strong></div>
                    </caption>
                    <thead>
                    <tr>
                      <th>Location</th>
                      <th>Object</th>
                      <th>Remark</th>
                      <th>Level</th>
                      <th>Author</th>
                      <th></th>
                    </tr>
                    </thead>
                    <%= content_tag :tbody, class: "RemarksTable", id: "RemarksTable", data: { url: inspection_remarks_url(@inspection)} do -%>
                        <% remarks_html = render partial: 'remarks/remark', collection: @inspection.remarks, as: :remark, locals: {inspection: @inspection }  %>
                        <%= remarks_html || '' %>
                    <% end -%>
                  </table>
                <% end -%>
                <%= render partial: 'remarks/create_remark', locals: {inspection: @inspection} %>
              </div>
            <% end -%>
            <%= content_tag :div, id: "chat", class: "ChatContainer span3 pull-right"  do -%>
              <div class="Dock">
                <p>-></p>
                <p>c h a t</p>
              </div>

              <div class="ChatInner">
                <div class="row-fluid MessageWindow">
                  <%= content_tag :div, class: "span12 well MessageWindowInner" do -%>
                      <%= content_tag :div, id: 'MessageContainer', class: "row-fluid MessageContainer", data: { url: inspection_chat_messages_url(@inspection) } do -%>
                          <% chat_html = render partial: 'chat_messages/chat_message', collection: @inspection.chat_messages, as: :chat_message, locals: {inspection: @inspection }   %>
                          <%= chat_html || 'Be the first to write a message'%>
                      <% end -%>
                  <% end -%>
                </div>

                <% if can? :create, ChatMessage, inspection_id: @inspection.id %>
                    <div class="row-fluid SendMessage">
                      <div class="span12 SendMessageInner">
                        <%= form_for [@inspection, @inspection.chat_messages.build], remote: true do |f| %>
                            <div class="row-fluid ChatTypeBoxRow">
                              <%= f.text_area :content, id: "ChatTypeBox", class: "ChatTypeBox pull-right", rows: 2, placeholder: "Type your answer" %>


                            </div>
                            <div class="row-fluid">
                              <%= f.submit "Send", class: "btn btn-primary pull-right" %>
                            </div>
                        <% end %>
                      </div>
                    </div>
                <% end %>
              </div>
            <% end -%>
        </div>
    </div>
</div>